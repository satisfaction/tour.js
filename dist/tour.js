!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.Tour=e()}(this,function(){"use strict";function t(t,e){return function(){return t.apply(e,arguments)}}function e(t){var e,i,o,s,n,h,d;n=(new Date).getTime(),o=document.createElementNS(v,"defs"),s=document.createElementNS(v,"filter"),s.setAttributeNS(null,"id",n),s.setAttributeNS(null,"x","-50%"),s.setAttributeNS(null,"y","-50%"),s.setAttributeNS(null,"width","200%"),s.setAttributeNS(null,"height","200%"),d=document.createElementNS(v,"feOffset"),d.setAttributeNS(null,"dx",1),d.setAttributeNS(null,"dy",1),d.setAttributeNS(null,"in","SourceGraphic"),d.setAttributeNS(null,"result","ShadowOffsetOuter"),i=document.createElementNS(v,"feGaussianBlur"),i.setAttributeNS(null,"stdDeviation",2),i.setAttributeNS(null,"in","ShadowOffsetOuter"),i.setAttributeNS(null,"result","ShadowBlurOuter"),h=document.createElementNS(v,"feColorMatrix"),h.setAttributeNS(null,"values","0 0 0 0 0   0 0 0 0 0   0 0 0 0 0   0 0 0 0.3 0"),h.setAttributeNS(null,"in","ShadowBlurOuter"),h.setAttributeNS(null,"result","ShadowMatrixOuter"),e=document.createElementNS(v,"feBlend"),e.setAttributeNS(null,"in","ShadowMatrixOuter"),e.setAttributeNS(null,"in2","SourceGraphic"),e.setAttributeNS(null,"mode","normal"),s.appendChild(d),s.appendChild(i),s.appendChild(h),s.appendChild(e),o.appendChild(s),t.appendChild(o),t.setAttribute("style","filter: url(#"+n+");")}function i(t){return"tourjs-"+(t?t+"-":"")+c++}function o(t){function e(){4==i.readyState&&200==i.status&&(m=document.createElement("div"),m.innerHTML=i.responseText,t.success&&t.success())}var i=new XMLHttpRequest;i.onreadystatechange=e,i.open("GET",t.svg||"dist/svg/defs.svg",!0),i.send()}function s(t){return t.getBoundingClientRect()}function n(){var t=document.documentElement;return{width:window.innerWidth||t.clientWidth,height:window.innerHeight||t.clientHeight}}function h(t,e){e=e||{};var i=m.querySelector(t).cloneNode(!0);return i.setAttribute("class","tourjs-shape"),e.transform&&i.setAttribute("transform",e.transform),i}function d(e){return this instanceof d?(this.id=i("hint"),this.options=e||{},void(this._setPosition=t(this._setPosition,this))):new d(e)}function l(e){this.options=e,this._setPosition=t(this._setPosition,this)}function r(t,e){this.id=i(),this.options=e||{},this.hints=t,this.highlights=[],this.hints.forEach(function(t){this.highlights.push(new l(t))}.bind(this))}function p(e){return this instanceof p?(this.id=i("overview"),this.options=e||{},void(this._setPosition=t(this._setPosition,this))):new p(e)}function a(t){return this instanceof a?(this.id=i("step"),"function"==typeof t.shouldShow&&(this.shouldShow=t.shouldShow,delete t.shouldShow),this.options=t.options||{},this._initOverview(this.options.overview),this.overlay=new r(t.hints,t.options.overlay),this.hints=[],void t.hints.forEach(function(t){this.hints.push(new d(t))}.bind(this))):new a(t)}function u(e){return this instanceof u?(this._onKeyUp=t(this._onKeyUp,this),this._onLoad=t(this._onLoad,this),this.unload=t(this.unload,this),this.id=i(),this.options=e.options||{},void this._initSteps(e.steps)):new u(e)}var c,f,m,v;return c=0,f=10,v="http://www.w3.org/2000/svg",d.prototype={load:function(t){if(!this.node){if(this.node=document.createElement("div"),this.node.id=this.id,this.node.className="tourjs-hint",this.node.className+=" tourjs-"+this.options.position+(this.options.inverted?"-inverted":""),this.node.className+=" tourjs-"+this.options.type,this.options.width){var e=this.options.width+"px";this.node.style.width=e,this.node.style.maxWidth=e}this._renderTooltip(),this._renderShape(),document.getElementById(this.id)||t.appendChild(this.node),this._setPosition()}window.addEventListener("resize",this._setPosition),window.addEventListener("scroll",this._setPosition)},unload:function(){window.removeEventListener("resize",this._setPosition),window.removeEventListener("scroll",this._setPosition)},_setPosition:function(){var t=s(document.querySelector(this.options.target)),e=s(this.node);switch(this.options.type){case"arrow":switch(this.options.position){case"top-left":this.node.style.top=t.top-e.height-f+"px",this.node.style.left=t.left-e.width-f+"px";break;case"top":this.node.style.top=t.top-e.height-f+"px",this.node.style.left=t.left+t.width/2-e.width/2+"px";break;case"top-right":this.node.style.top=t.top-e.height-f+"px",this.node.style.left=t.left+t.width+f+"px";break;case"right":this.node.style.top=t.height>e.height?t.top+(t.height-e.height)/2+"px":t.top-(e.height-t.height)/2+"px",this.node.style.left=t.left+t.width+f+"px";break;case"bottom-right":this.node.style.top=t.bottom+f+"px",this.node.style.left=t.left+t.width+f+"px";break;case"bottom":this.node.style.top=t.bottom+f+"px",this.node.style.left=t.left+t.width/2-e.width/2+"px";break;case"bottom-left":this.node.style.top=t.bottom+f+"px",this.node.style.left=t.left-e.width-f+"px";break;case"left":this.node.style.top=t.height>e.height?t.top+(t.height-e.height)/2+"px":t.top-(e.height-t.height)/2+"px",this.node.style.left=t.left-e.width-f+"px"}break;case"curved-arrow":switch(this.options.position){case"top-left":this.node.style.top=t.top-e.height-f+"px",this.node.style.left=t.left-e.width-f+"px";break;case"top":this.node.style.top=t.top-e.height-f+"px",this.node.style.left=this.options.inverted?t.left+t.width/2-e.width+16+"px":t.left+t.width/2-16+"px";break;case"top-right":this.node.style.top=t.top-e.height-f+"px",this.node.style.left=t.left+t.width+f+"px";break;case"right":this.node.style.top=t.height>e.height?this.options.inverted?t.top+t.height/2-e.height+16+"px":t.top+t.height/2+"px":this.options.inverted?t.top-t.height/2-e.height/2+12+"px":t.top+t.height/2-16+"px",this.node.style.left=t.left+t.width+f+"px";break;case"bottom-right":this.node.style.top=t.bottom+f+"px",this.node.style.left=t.left+t.width+f+"px";break;case"bottom":this.node.style.top=t.bottom+f+"px",this.node.style.left=this.options.inverted?t.left+t.width/2-16+"px":t.left+t.width/2-e.width+16+"px";break;case"bottom-left":this.node.style.top=t.bottom+f+"px",this.node.style.left=t.left-e.width-f+"px";break;case"left":this.node.style.top=t.height>e.height?this.options.inverted?t.top+t.height/2-16+"px":t.top-(e.height-t.height/2)+16+"px":this.options.inverted?t.top+t.height/2-e.height/2+24+"px":t.top+t.height/2-e.height+18+"px",this.node.style.left=t.left-e.width-f+"px"}}},_renderDescription:function(t){var e;this.options.description&&(e=document.createElement("div"),e.className="tourjs-description",e.innerHTML=this.options.description,t.appendChild(e))},_renderShape:function(){var t=h("#tourjs-symbol-"+this.options.type+"-"+this.options.position+(this.options.inverted?"-inverted":""));e(t),this.node.appendChild(t)},_renderTitle:function(t){var e=document.createElement("h2");e.innerHTML=this.options.title,t.appendChild(e)},_renderTooltip:function(){var t=document.createElement("div");t.className="tourjs-tooltip",this.options.width&&(this.node.style.width=this.options.width+"px",this.node.style.maxWidth=this.options.width+"px"),this._renderTitle(t),this._renderDescription(t),this.node.appendChild(t)}},l.prototype={load:function(){return this.options.highlight!==!1?(this.node||(this.node=document.createElementNS(v,"rect"),this.node.setAttributeNS(null,"style","stroke:none;fill:#000;")),this._setPosition(),window.addEventListener("resize",this._setPosition),window.addEventListener("scroll",this._setPosition),this.node):void 0},unload:function(){this.node&&(window.removeEventListener("resize",this._setPosition),window.removeEventListener("scroll",this._setPosition))},_setPosition:function(){var t,e,i;this.node&&(i=document.querySelector(this.options.highlight?this.options.highlight:this.options.target),e=s(i),t=this.options.padding||0,this.node.setAttributeNS(null,"x",e.left-t),this.node.setAttributeNS(null,"y",e.top-t),this.node.setAttributeNS(null,"height",e.height+2*t),this.node.setAttributeNS(null,"width",e.width+2*t))}},r.prototype={load:function(t){var e,i,o,s;this.node?(this.node.style.display="block",this.highlights.forEach(function(t){t.load()})):(this.node=document.createElementNS(v,"svg"),this.node.setAttributeNS(null,"id","overlay-"+this.id),this.node.setAttributeNS(null,"class","tourjs-overlay"),this.node.setAttributeNS(null,"x",0),this.node.setAttributeNS(null,"y",0),this.node.setAttributeNS(null,"height","100%"),this.node.setAttributeNS(null,"width","100%"),e=document.createElementNS(v,"defs"),i=document.createElementNS(v,"mask"),i.setAttributeNS(null,"x",0),i.setAttributeNS(null,"y",0),i.setAttributeNS(null,"height","100%"),i.setAttributeNS(null,"width","100%"),i.setAttributeNS(null,"id","overlay-"+this.id+"-mask"),s=document.createElementNS(v,"rect"),s.setAttributeNS(null,"x",0),s.setAttributeNS(null,"y",0),s.setAttributeNS(null,"height","100%"),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"style","stroke:none;fill:#FFF;"),i.appendChild(s),this.highlights.forEach(function(t){t.load()&&i.appendChild(t.load())}),e.appendChild(i),this.node.appendChild(e),o=this.options.opacity||"0.8",s=document.createElementNS(v,"rect"),s.setAttributeNS(null,"x",0),s.setAttributeNS(null,"y",0),s.setAttributeNS(null,"height","100%"),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"style","stroke:none;fill:rgba(0,0,0,"+o+");mask:url(#overlay-"+this.id+"-mask);"),this.node.appendChild(s),t.appendChild(this.node))},unload:function(){this.node&&(this.node.style.display="none",this.highlights.forEach(function(t){t.unload()}))}},p.prototype={load:function(t){var e,i,o;if(!this.node){if(this.node=document.createElement("div"),this.node.id=this.id,this.node.className="tourjs-overview",this.options.width){var s=this.options.width+"px";this.node.style.width=s,this.node.style.maxWidth=s}o=document.createElement("h1"),o.innerHTML=this.options.title,o.className="tourjs-overview-title",this.node.appendChild(o),this.options.description&&(i=document.createElement("div"),i.className="tourjs-overview-line",i.appendChild(h("#tourjs-symbol-line")),this.node.appendChild(i),e=document.createElement("div"),e.innerHTML=this.options.description,e.className="tourjs-overview-description",this.node.appendChild(e)),document.getElementById(this.id)||t.appendChild(this.node)}return window.addEventListener("resize",this._setPosition),window.addEventListener("scroll",this._setPosition),window.setTimeout(function(){this._setPosition()}.bind(this),0),this.node},unload:function(){window.removeEventListener("resize",this._setPosition),window.removeEventListener("scroll",this._setPosition)},_setPosition:function(){var t=100,e=s(this.node),i=n();switch(this.options.position){case"top":this.node.style.left=i.width/2-e.width/2+"px",this.node.style.top=t+"px";break;case"top-right":this.node.style.right=t+"px",this.node.style.top=t+"px";break;case"right":this.node.style.right=t+"px",this.node.style.top=i.height/2-e.height/2+"px";break;case"bottom-right":this.node.style.right=t+"px",this.node.style.bottom=1.5*t+"px";break;case"bottom":this.node.style.left=i.width/2-e.width/2+"px",this.node.style.bottom=1.5*t+"px";break;case"bottom-left":this.node.style.left=t+"px",this.node.style.bottom=1.5*t+"px";break;case"left":this.node.style.left=t+"px",this.node.style.top=i.height/2-e.height/2+"px";break;case"top-left":this.node.style.left=t+"px",this.node.style.top=t+"px";break;default:this.node.style.left=i.width/2-e.width/2+"px",this.node.style.top=i.height/2-e.height/2+"px"}}},a.prototype={load:function(t,e){var i=function(){this.node?this.node.style.display="block":(this.node=document.createElement("div"),this.node.id=this.id,this.node.className="tourjs-step",document.getElementById(this.id)||t.appendChild(this.node),this._paginate(t),this._loadOverview()),this.overlay.load(this.node),this.hints.forEach(function(t){t.load(this.node)}.bind(this)),e&&e(this),"function"==typeof this.options.afterLoad&!this.loaded&&this.options.afterLoad(this),this.loaded=!0}.bind(this);"function"==typeof this.options.beforeLoad&!this.loaded?this.options.beforeLoad(this,i):i()},unload:function(){var t=function(){this.node&&(this.node.style.display="none",this.hints.forEach(function(t){t.unload()})),"function"==typeof this.options.afterUnload&&this.loaded===!0&&this.options.afterUnload(this),this.loaded=!1}.bind(this);"function"==typeof this.options.beforeUnload&&this.loaded===!0?this.options.beforeUnload(this,t):t()},_initOverview:function(t){t&&!this.overview&&(this.overview=new p(t))},_loadOverview:function(){this.overview&&this.node.appendChild(this.overview.load(this.node))},_paginate:function(t){var e,i,o,s,n,d;if(this.previous||this.next){o=document.createElement("div"),o.className="tourjs-pagination",d=document.createElement("div"),d.className="tourjs-pagination-wrapper",s=document.createElement("div"),s.className="tourjs-previous-step",this.previous?s.addEventListener("click",function(e){e.stopPropagation(),this.unload(),this.previous.load(t)}.bind(this)):s.className+=" tourjs-step-disabled",n=h("#tourjs-symbol-chevron-left"),s.appendChild(n),d.appendChild(s);var l=document.createElement("div");l.className="tourjs-step-count",l.innerHTML="Step "+this.options.index+" of "+this.options.stepCount,d.appendChild(l),e=document.createElement("div"),e.className="tourjs-next-step",this.next?e.addEventListener("click",function(e){e.stopPropagation(),this.unload(),this.next.load(t)}.bind(this)):e.className+=" tourjs-step-disabled",i=h("#tourjs-symbol-chevron-right"),e.appendChild(i),d.appendChild(e),o.appendChild(d),this.node.appendChild(o)}}},u.prototype={load:function(){var t=function(){this.node||(this.node=document.createElement("div"),this.node.id=this.id,this.node.className="tourjs",document.getElementById(this.id)||document.body.appendChild(this.node)),o({svg:this.options.svg,success:this._onLoad})}.bind(this);"function"==typeof this.options.beforeLoad?this.options.beforeLoad(t):t()},unload:function(){var t=function(){document.removeEventListener("keyup",this._onKeyUp),this.steps.forEach(function(t){t.unload()}),this._unloadCloseButton(),"function"==typeof this.options.afterUnload&&this.options.afterUnload()}.bind(this);"function"==typeof this.options.beforeUnload?this.options.beforeUnload(t):t()},_initSteps:function(t){if(this.steps=[],t){var e=t.lenght;t.forEach(function(t){t.options||(t.options={});var i=new a(t);"function"==typeof i.shouldShow?i.shouldShow(function(t){t&&this.steps.push(i),e--}.bind(this)):(this.steps.push(i),e--)}.bind(this));var i;(i=function(){e&&setTimeout(i,1)})()}var o;this.steps.forEach(function(t,e){t.options.index=e+1,t.options.stepCount=this.steps.length,o&&(t.previous=o,o.next=t),o=t}.bind(this)),this._initialized=!0},_onKeyUp:function(t){27===t.keyCode&&this.unload()},_onLoad:function(){document.addEventListener("keyup",this._onKeyUp),this._loadCloseButton(),this._loadFirstStep(),"function"==typeof this.options.afterLoad&&this.options.afterLoad()},_loadFirstStep:function(){this.loadStep(1)},loadStep:function(t){this.steps.forEach(function(e){e.options.index===t?e.load(this.node):e.unload()}.bind(this))},_loadCloseButton:function(){var t=document.getElementById("tourjs-close");t||(t=h("#tourjs-symbol-close"),t.id="tourjs-close",e(t),this.node.appendChild(t)),t.addEventListener("click",this.unload),t.style.display="block"},_unloadCloseButton:function(){var t=document.getElementById("tourjs-close");t&&(t.style.display="none",t.removeEventListener("click",this.unload))}},u});